![ci](https://github.com/Waltberry/api-smoke-reqres/actions/workflows/ci.yml/badge.svg)

# API Smoke Tests — `reqres.in` (pytest + requests)

> A resilient, CI-friendly API smoke pack exercising a public demo API (`reqres.in`).
> Focus: quick health, happy-path auth, common negatives, and lightweight schema spot-checks — with retries, HTML/JUnit reports, and smart handling of rate-limit/WAF blocks.

---

## What’s inside

* **Tests**: `tests/api/test_reqres_smoke.py`

  * Health check (`GET /api/users`)
  * Positive login (`POST /api/login`)
  * Negative login (missing password)
  * 404 check
  * Schema spot-checks (keys/types at a glance)
* **HTTP client**: `utils/http.py`

  * Browser-like headers (helps avoid naive WAF)
  * `urllib3.Retry` on 429/5xx
  * Per-request default timeout
* **Session probe**: `tests/conftest.py`

  * On run start, ping API once
  * If blocked (403/429) or unstable (5xx), **skip** or **xfail** entire session (configurable)
* **Reports**

  * HTML: `reports/api-report.html` (pytest-html)
  * JUnit: `reports/junit/api-tests.xml`
* **CI**: `.github/workflows/ci.yml`

---

## Project tree

```
.
├─ utils/
│  └─ http.py                 # requests Session with retries & headers
├─ tests/
│  ├─ api/
│  │  └─ test_reqres_smoke.py # smoke, auth, negative, schema spot checks
│  └─ conftest.py             # one-time probe (skip/xfail if blocked)
├─ reports/
│  ├─ api-report.html         # generated by pytest-html
│  └─ junit/api-tests.xml     # generated JUnit
├─ .github/workflows/ci.yml   # matrix CI with artifacts
├─ requirements.txt
├─ pytest.ini                 # markers, HTML/JUnit output paths
├─ conftest.py                # root: adds repo to PYTHONPATH
└─ README.md
```

---

## Quick start

### 1) Install

```bash
python -m venv .venv
source .venv/bin/activate        # Bash
# .venv\Scripts\Activate.ps1     # PowerShell
pip install -r requirements.txt
```

### 2) Run (PowerShell)

```powershell
pytest
pytest -m smoke
pytest -m "auth and not negative"
pytest -k login
```

---

## Configuration (env vars)

| Variable          | Default             | Meaning                                                                                |
| ----------------- | ------------------- | -------------------------------------------------------------------------------------- |
| `API_BASE`        | `https://reqres.in` | Override target base URL                                                               |
| `API_TIMEOUT`     | `15`                | Per-request timeout (seconds)                                                          |
| `API_SKIP_ON_403` | `1`                 | If API probe returns 403/429, **skip** entire session (stable CI)                      |
| `API_STRICT`      | `0`                 | If `1`, **xfail** on 403/429/5xx instead of skipping (still won’t hard-fail the build) |

> **Why skip/xfail?** Public demo APIs can throttle/block automation. We want **signal**, not noise. When the API is clearly blocked.

---

## Extending the suite

* **Add more endpoints** (update, delete, paginated lists)
* **Richer schema**: introduce `jsonschema` or `pydantic` for stricter structure checks
* **Security/negative**: malformed payloads, boundary values, very large bodies
* **Load-lite**: a quick loop with randomized inputs (still smoke-level, not load test)